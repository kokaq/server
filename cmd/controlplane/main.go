package main

import (
	"context"
	"flag"
	"fmt"
	"os"
	"os/signal"
	"syscall"

	"github.com/kokaq/server/internals/control"
	"github.com/kokaq/server/internals/shard"
)

func main() {
	ports := flag.String("shard", "9000", "TCP port to listen on")
	flag.Parse()
	portc := flag.String("control", "9001", "TCP port to listen on")
	flag.Parse()

	fmt.Println(`

           @@@@@                            @@@@@           
         @@@@%#@@@@    @@@@@@@@@@@@@@    @@@@#%@@@@         
        @@+..-@#++@@@@@#++++++++++++#@@@@@++#@-..+@@        
        @@-...:@%+++*++++++++++++++++++*+++%@:...:@@        
        @@-...%*@*++++++++++++++++++++++++*@*@...-@@        
        @@#:..*@#++++++++++++++++++++++++++#@*...#@@        
         @@%::@#+++%@@@*++++++++++++*@@@%+++#@:.%@@         
          @@@@%++++*++++++++*##*++++++++*++++%@@@@          
           @@@++++++#%%*++%@@@@@@%++*%%%++++++@@@           
         @@@@%#++++*@@@#+@@@@@@@@@@+#@@@*++++#%@@@@         
        @@@@*++++++#%%%*%@@@@@@@@@@%+%%%#++++++*@@@@        
       @@@*+++++++++++++%@@@@@@@@@@%+++++++++++++*@@        
       @@#+++++++++*@@%++%@@@@@@@@%++%@@#+++++++++*@@       
       @@*++++++++++*@@#+++*%@@%*+++#@@*+++++++++++%@       
       @@*+++++++++++*@@@@@@@@@@@@@@@@*++++++++++++@@@      
       @@#+*+++++++++++%@@@%%@@%%@@@%+++++++++++***@@       
       @@@#**+++++++++++*@@******@@*++++++++++***#@@@       
         @@@#***++++++++++*@@@@@@*++++++++++***#%@@         
          @@@@#***+++*#*++++++++++++*#*++++**#@@@@          
             @@@@%**+++%@%*++++++*%@@+++**%@@@@             
                @@@@%++++*%@@@@@@@*++++%@@@@                
                     ++++++++++++++++++                     
                        ++++++++++++                        
                            ++++                         
        ██╗  ██╗ ██████╗ ██╗  ██╗ █████╗ ███████╗
        ██║ ██╔╝██╔═══██╗██║ ██╔╝██╔══██╗██╔══██║
        █████╔╝ ██║   ██║█████╔╝ ███████║██║  ██║
        ██╔═██╗ ██║   ██║██╔═██╗ ██╔══██║██║  ██║
        ██║  ██╗╚██████╔╝██║  ██╗██║  ██║██████╔╝
        ╚═╝  ╚═╝ ╚═════╝ ╚═╝  ╚═╝╚═╝  ╚═╝╚════██╗
                                              ╚═╝   
                                                            `)

	ctx, stop := signal.NotifyContext(context.Background(), os.Interrupt, syscall.SIGTERM)
	defer stop()

	go func() {
		shard.StartShardManager(":" + *ports)
	}()

	go func() {
		control.StartControlServer(":"+*portc, ":"+*ports)
	}()

	<-ctx.Done()
}
